<html>
<head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">

	<title>Mapa dos Pólos UAB</title>
	<meta charset="utf-8">
	<script src="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.js"></script>
	<link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet/v0.7.7/leaflet.css" />
	<script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

	<script src="ipes-all.json" type="text/javascript"></script>

	<style type="text/css" charset="utf-8">
		#map {
			height: 500px;
			margin-left:auto;
			margin-right:auto;
			width:50%;
			border-style: solid;
			border-color: #555;
			border-width: 5px;
			-moz-border-radius: 10px;
			border-radius: 10px;
		}
	</style>
</head>
<body>

	<div id="map"></div><br>

	<script>

	var base = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
	  attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
	  });

	var brasil = L.geoJson(null, {
		style: {
			weight: 1,
			color: "#fff",
			opacity: 1,
			fillColor: "#ccc",
			fillOpacity: 1
			}
			});
			$.getJSON("br_estados.json", function(data) {
				brasil.addData(data);
			});

	var ipes = L.geoJson(null, {onEachFeature: onEachFeature, pointToLayer: pointToLayer});
	$.getJSON("ipes-all.json", function (data) {
	  ipes.addData(data);
	});

  function onEachFeature (feature, marker) {
		if (feature.properties) {
			marker.bindPopup(
				'<b>' + feature.properties.Sigla + '</b>' + '<br>' +
				feature.properties.Cidade + ', ' + feature.properties.Estado + '</br>' +
				feature.properties.Logradouro + ' - ' + feature.properties.Bairro + '</br>' +
				feature.properties.CEP + '</br>' +
				'Telefone :' + feature.properties.Telefone + '</br>' +
				'<a href="' + feature.properties.URL + '">' + feature.properties.URL + '</a>'
			)
		}
	};

	function pointToLayer (feature, latlng) {
		 return L.circleMarker(latlng, {
			 radius: 6,
			 fillColor: "#267FCA", color: "#000",
			 weight: 1,
			 opacity: 1,
			 fillOpacity: 0.3
		 });
	 };

var map = L.map('map', {layers: [base,ipes]}).setView(new L.LatLng(-14.953349393643416,-52.220703125),4);

var baseMaps = {"Mapa": brasil};
var overlayMaps = {
	"Brasil" :brasil,
	"IPES" : ipes
};

//Ordem de camadas de vetores só será resolvida no Leaflet v1.0. Por isso a camada das
//zIndex() e bringToFront() não funcionam com vetores.
//Confirmado problema. Verificar também: http://gis.stackexchange.com/questions/166252/geojson-layer-order-in-leaflet-0-7-5
L.control.layers(baseMaps, overlayMaps,{position: 'topleft'}).addTo(map);
</script>
</body>

</html>
